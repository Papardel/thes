{
  "bug_id": "25",
  "failed_tests": {
    "org.apache.commons.cli.bug.BugCLI162Test": [
      {
        "methodName": "testLongLineChunkingIndentIgnored",
        "error": "junit.framework.ComparisonFailure",
        "message": "Long arguments did not split as expected expected:<...",
        "fail_line": "        assertEquals( \"Long arguments did not split as expected\", expected, sw.toString() );",
        "test_source": "  public void testLongLineChunkingIndentIgnored() throws ParseException, IOException {\n  Options options = new Options();\n  options.addOption(\"x\", \"extralongarg\", false, \"This description is Long.\" );\n  HelpFormatter formatter = new HelpFormatter();\n  StringWriter sw = new StringWriter();\n  formatter.printHelp(new PrintWriter(sw), 22, this.getClass().getName(), \"Header\", options, 0, 5, \"Footer\");\n  System.err.println(sw.toString());\n  String expected = \"usage:\\n\" +\n  \"  org.apache.comm\\n\" +\n  \"  ons.cli.bug.Bug\\n\" +\n  \"  CLI162Test\\n\" +\n  \"Header\\n\" +\n  \"-x,--extralongarg\\n\" +\n  \" This description is\\n\" +\n  \" Long.\\n\" +\n  \"Footer\\n\";\n  assertEquals( \"Long arguments did not split as expected\", expected, sw.toString() );\n  }",
        "stack": [
          "BugCLI162Test.testLongLineChunkingIndentIgnored line 280"
        ]
      }
    ]
  },
  "classes": [
    {
      "name": "org/apache/commons/cli/HelpFormatter.java",
      "buggy_full_code": "\n\npackage org.apache.commons.cli;\n\nimport java.io.PrintWriter;\nimport java.util.ArrayList;\nimport java.util.Collection;\nimport java.util.Collections;\nimport java.util.Comparator;\nimport java.util.Iterator;\nimport java.util.List;\n\n\npublic class HelpFormatter { public static final int DEFAULT_WIDTH = 74; public static final int DEFAULT_LEFT_PAD = 1; public static final int DEFAULT_DESC_PAD = 3; public static final String DEFAULT_SYNTAX_PREFIX = \"usage: \"; public static final String DEFAULT_OPT_PREFIX = \"-\"; public static final String DEFAULT_LONG_OPT_PREFIX = \"--\"; public static final String DEFAULT_ARG_NAME = \"arg\"; public int defaultWidth = DEFAULT_WIDTH; public int defaultLeftPad = DEFAULT_LEFT_PAD; public int defaultDescPad = DEFAULT_DESC_PAD; public String defaultSyntaxPrefix = DEFAULT_SYNTAX_PREFIX; public String defaultNewLine = System.getProperty(\"line.separator\"); public String defaultOptPrefix = DEFAULT_OPT_PREFIX; public String defaultLongOptPrefix = DEFAULT_LONG_OPT_PREFIX; public String defaultArgName = DEFAULT_ARG_NAME; protected Comparator optionComparator = new OptionComparator(); public void setWidth(int width) {\n        this.defaultWidth = width;\n    }\n\n    \n    public int getWidth() {\n        return defaultWidth;\n    }\n\n    \n    public void setLeftPadding(int padding) {\n        this.defaultLeftPad = padding;\n    }\n\n    \n    public int getLeftPadding() {\n        return defaultLeftPad;\n    }\n\n    \n    public void setDescPadding(int padding) {\n        this.defaultDescPad = padding;\n    }\n\n    \n    public int getDescPadding() {\n        return defaultDescPad;\n    }\n\n    \n    public void setSyntaxPrefix(String prefix) {\n        this.defaultSyntaxPrefix = prefix;\n    }\n\n    \n    public String getSyntaxPrefix() {\n        return defaultSyntaxPrefix;\n    }\n\n    \n    public void setNewLine(String newline) {\n        this.defaultNewLine = newline;\n    }\n\n    \n    public String getNewLine() {\n        return defaultNewLine;\n    }\n\n    \n    public void setOptPrefix(String prefix) {\n        this.defaultOptPrefix = prefix;\n    }\n\n    \n    public String getOptPrefix() {\n        return defaultOptPrefix;\n    }\n\n    \n    public void setLongOptPrefix(String prefix) {\n        this.defaultLongOptPrefix = prefix;\n    }\n\n    \n    public String getLongOptPrefix() {\n        return defaultLongOptPrefix;\n    }\n\n    \n    public void setArgName(String name) {\n        this.defaultArgName = name;\n    }\n\n    \n    public String getArgName() {\n        return defaultArgName;\n    }\n\n    \n    public Comparator getOptionComparator() {\n        return optionComparator;\n    }\n\n    \n    public void setOptionComparator(Comparator comparator) {\n        if (comparator == null)\n        {\n            this.optionComparator = new OptionComparator();\n        }\n        else\n        {\n            this.optionComparator = comparator;\n        }\n    }\n\n    \n    public void printHelp(String cmdLineSyntax, Options options) {\n        printHelp(defaultWidth, cmdLineSyntax, null, options, null, false);\n    }\n\n    \n    public void printHelp(String cmdLineSyntax, Options options, boolean autoUsage) {\n        printHelp(defaultWidth, cmdLineSyntax, null, options, null, autoUsage);\n    }\n\n    \n    public void printHelp(String cmdLineSyntax, String header, Options options, String footer) {\n        printHelp(cmdLineSyntax, header, options, footer, false);\n    }\n\n    \n    public void printHelp(String cmdLineSyntax, String header, Options options, String footer, boolean autoUsage) {\n        printHelp(defaultWidth, cmdLineSyntax, header, options, footer, autoUsage);\n    }\n\n    \n    public void printHelp(int width, String cmdLineSyntax, String header, Options options, String footer) {\n        printHelp(width, cmdLineSyntax, header, options, footer, false);\n    }\n\n    \n    public void printHelp(int width, String cmdLineSyntax, String header, Options options, String footer, boolean autoUsage) {\n        PrintWriter pw = new PrintWriter(System.out);\n\n        printHelp(pw, width, cmdLineSyntax, header, options, defaultLeftPad, defaultDescPad, footer, autoUsage);\n        pw.flush();\n    }\n\n    \n    public void printHelp(PrintWriter pw, int width, String cmdLineSyntax, String header, Options options, int leftPad, int descPad, String footer) {\n        printHelp(pw, width, cmdLineSyntax, header, options, leftPad, descPad, footer, false);\n    }\n\n\n    \n    public void printHelp(PrintWriter pw, int width, String cmdLineSyntax, String header, Options options, int leftPad, int descPad, String footer, boolean autoUsage) {\n        if ((cmdLineSyntax == null) || (cmdLineSyntax.length() == 0))\n        {\n            throw new IllegalArgumentException(\"cmdLineSyntax not provided\");\n        }\n\n        if (autoUsage)\n        {\n            printUsage(pw, width, cmdLineSyntax, options);\n        }\n        else\n        {\n            printUsage(pw, width, cmdLineSyntax);\n        }\n\n        if ((header != null) && (header.trim().length() > 0))\n        {\n            printWrapped(pw, width, header);\n        }\n\n        printOptions(pw, width, options, leftPad, descPad);\n\n        if ((footer != null) && (footer.trim().length() > 0))\n        {\n            printWrapped(pw, width, footer);\n        }\n    }\n\n    \n    public void printUsage(PrintWriter pw, int width, String app, Options options) {\n        \n        StringBuffer buff = new StringBuffer(defaultSyntaxPrefix).append(app).append(\" \");\n\n        \n        final Collection processedGroups = new ArrayList();\n\n        \n        Option option;\n\n        List optList = new ArrayList(options.getOptions());\n        Collections.sort(optList, getOptionComparator());\n        \n        for (Iterator i = optList.iterator(); i.hasNext();)\n        {\n            \n            option = (Option) i.next();\n\n            \n            OptionGroup group = options.getOptionGroup(option);\n\n            \n            if (group != null)\n            {\n                \n                if (!processedGroups.contains(group))\n                {\n                    \n                    processedGroups.add(group);\n\n\n                    \n                    appendOptionGroup(buff, group);\n                }\n\n                \n                \n            }\n\n            \n            else\n            {\n                appendOption(buff, option, option.isRequired());\n            }\n\n            if (i.hasNext())\n            {\n                buff.append(\" \");\n            }\n        }\n\n\n        \n        printWrapped(pw, width, buff.toString().indexOf(' ') + 1, buff.toString());\n    }\n\n    \n    private void appendOptionGroup(final StringBuffer buff, final OptionGroup group) {\n        if (!group.isRequired())\n        {\n            buff.append(\"[\");\n        }\n\n        List optList = new ArrayList(group.getOptions());\n        Collections.sort(optList, getOptionComparator());\n        \n        for (Iterator i = optList.iterator(); i.hasNext();)\n        {\n            \n            appendOption(buff, (Option) i.next(), true);\n\n            if (i.hasNext())\n            {\n                buff.append(\" | \");\n            }\n        }\n\n        if (!group.isRequired())\n        {\n            buff.append(\"]\");\n        }\n    }\n\n    \n    private static void appendOption(final StringBuffer buff, final Option option, final boolean required) {\n        if (!required)\n        {\n            buff.append(\"[\");\n        }\n\n        if (option.getOpt() != null)\n        {\n            buff.append(\"-\").append(option.getOpt());\n        }\n        else\n        {\n            buff.append(\"--\").append(option.getLongOpt());\n        }\n\n        \n        if (option.hasArg() && option.hasArgName())\n        {\n            buff.append(\" <\").append(option.getArgName()).append(\">\");\n        }\n\n        \n        if (!required)\n        {\n            buff.append(\"]\");\n        }\n    }\n\n    \n    public void printUsage(PrintWriter pw, int width, String cmdLineSyntax) {\n        int argPos = cmdLineSyntax.indexOf(' ') + 1;\n\n        printWrapped(pw, width, defaultSyntaxPrefix.length() + argPos, defaultSyntaxPrefix + cmdLineSyntax);\n    }\n\n    \n    public void printOptions(PrintWriter pw, int width, Options options, int leftPad, int descPad) {\n        StringBuffer sb = new StringBuffer();\n\n        renderOptions(sb, width, options, leftPad, descPad);\n        pw.println(sb.toString());\n    }\n\n    \n    public void printWrapped(PrintWriter pw, int width, String text) {\n        printWrapped(pw, width, 0, text);\n    }\n\n    \n    public void printWrapped(PrintWriter pw, int width, int nextLineTabStop, String text) {\n        StringBuffer sb = new StringBuffer(text.length());\n\n        renderWrappedText(sb, width, nextLineTabStop, text);\n        pw.println(sb.toString());\n    }\n\n    \n\n    \n    protected StringBuffer renderOptions(StringBuffer sb, int width, Options options, int leftPad, int descPad) {\n        final String lpad = createPadding(leftPad);\n        final String dpad = createPadding(descPad);\n\n        \n        \n        \n        \n        int max = 0;\n        StringBuffer optBuf;\n        List prefixList = new ArrayList();\n\n        List optList = options.helpOptions();\n\n        Collections.sort(optList, getOptionComparator());\n\n        for (Iterator i = optList.iterator(); i.hasNext();)\n        {\n            Option option = (Option) i.next();\n            optBuf = new StringBuffer(8);\n\n            if (option.getOpt() == null)\n            {\n                optBuf.append(lpad).append(\"   \" + defaultLongOptPrefix).append(option.getLongOpt());\n            }\n            else\n            {\n                optBuf.append(lpad).append(defaultOptPrefix).append(option.getOpt());\n\n                if (option.hasLongOpt())\n                {\n                    optBuf.append(',').append(defaultLongOptPrefix).append(option.getLongOpt());\n                }\n            }\n\n            if (option.hasArg())\n            {\n                if (option.hasArgName())\n                {\n                    optBuf.append(\" <\").append(option.getArgName()).append(\">\");\n                }\n                else\n                {\n                    optBuf.append(' ');\n                }\n            }\n\n            prefixList.add(optBuf);\n            max = (optBuf.length() > max) ? optBuf.length() : max;\n        }\n\n        int x = 0;\n\n        for (Iterator i = optList.iterator(); i.hasNext();)\n        {\n            Option option = (Option) i.next();\n            optBuf = new StringBuffer(prefixList.get(x++).toString());\n\n            if (optBuf.length() < max)\n            {\n                optBuf.append(createPadding(max - optBuf.length()));\n            }\n\n            optBuf.append(dpad);\n\n            int nextLineTabStop = max + descPad;\n\n            if (option.getDescription() != null)\n            {\n                optBuf.append(option.getDescription());\n            }\n\n            renderWrappedText(sb, width, nextLineTabStop, optBuf.toString());\n\n            if (i.hasNext())\n            {\n                sb.append(defaultNewLine);\n            }\n        }\n\n        return sb;\n    }\n\n    \n    protected StringBuffer renderWrappedText(StringBuffer sb, int width, int nextLineTabStop, String text) {\n        int pos = findWrapPos(text, width, 0);\n\n        if (pos == -1)\n        {\n            sb.append(rtrim(text));\n\n            return sb;\n        }\n        sb.append(rtrim(text.substring(0, pos))).append(defaultNewLine);\n\n        if (nextLineTabStop >= width)\n        {\n            \n            nextLineTabStop = width - 1;\n        }\n\n        \n        \n        final String padding = createPadding(nextLineTabStop);\n\n        while (true)\n        {\n            text = padding + text.substring(pos).trim();\n            pos = findWrapPos(text, width, 0);\n\n            if (pos == -1)\n            {\n                sb.append(text);\n\n                return sb;\n            }\n            \n            if ( (text.length() > width) && (pos == nextLineTabStop - 1) ) \n            {\n                pos = width;\n            }\n\n            sb.append(rtrim(text.substring(0, pos))).append(defaultNewLine);\n        }\n    }\n\n    \n    protected int findWrapPos(String text, int width, int startPos) {\n        int pos = -1;\n\n        \n        if (((pos = text.indexOf('\\n', startPos)) != -1 && pos <= width)\n                || ((pos = text.indexOf('\\t', startPos)) != -1 && pos <= width))\n        {\n            return pos + 1;\n        }\n        else if (startPos + width >= text.length())\n        {\n            return -1;\n        }\n\n\n        \n        pos = startPos + width;\n\n        char c;\n\n        while ((pos >= startPos) && ((c = text.charAt(pos)) != ' ')\n                && (c != '\\n') && (c != '\\r'))\n        {\n            --pos;\n        }\n\n        \n        if (pos > startPos)\n        {\n            return pos;\n        }\n        \n        \n        \n        pos = startPos + width;\n\n        while ((pos <= text.length()) && ((c = text.charAt(pos)) != ' ')\n               && (c != '\\n') && (c != '\\r'))\n        {\n            ++pos;\n        }\n\n        return (pos == text.length()) ? (-1) : pos;\n    }\n\n    \n    protected String createPadding(int len) {\n        StringBuffer sb = new StringBuffer(len);\n\n        for (int i = 0; i < len; ++i)\n        {\n            sb.append(' ');\n        }\n\n        return sb.toString();\n    }\n\n    \n    protected String rtrim(String s) {\n        if ((s == null) || (s.length() == 0))\n        {\n            return s;\n        }\n\n        int pos = s.length();\n\n        while ((pos > 0) && Character.isWhitespace(s.charAt(pos - 1)))\n        {\n            --pos;\n        }\n\n        return s.substring(0, pos);\n    }\n\n    \n    \n    \n    \n    private static class OptionComparator implements Comparator { public int compare(Object o1, Object o2) {\n            Option opt1 = (Option) o1;\n            Option opt2 = (Option) o2;\n\n            return opt1.getKey().compareToIgnoreCase(opt2.getKey());\n        }\n    }\n}\n",
      "fixed_full_code": "\n\npackage org.apache.commons.cli;\n\nimport java.io.PrintWriter;\nimport java.util.ArrayList;\nimport java.util.Collection;\nimport java.util.Collections;\nimport java.util.Comparator;\nimport java.util.Iterator;\nimport java.util.List;\n\n\npublic class HelpFormatter { public static final int DEFAULT_WIDTH = 74; public static final int DEFAULT_LEFT_PAD = 1; public static final int DEFAULT_DESC_PAD = 3; public static final String DEFAULT_SYNTAX_PREFIX = \"usage: \"; public static final String DEFAULT_OPT_PREFIX = \"-\"; public static final String DEFAULT_LONG_OPT_PREFIX = \"--\"; public static final String DEFAULT_ARG_NAME = \"arg\"; public int defaultWidth = DEFAULT_WIDTH; public int defaultLeftPad = DEFAULT_LEFT_PAD; public int defaultDescPad = DEFAULT_DESC_PAD; public String defaultSyntaxPrefix = DEFAULT_SYNTAX_PREFIX; public String defaultNewLine = System.getProperty(\"line.separator\"); public String defaultOptPrefix = DEFAULT_OPT_PREFIX; public String defaultLongOptPrefix = DEFAULT_LONG_OPT_PREFIX; public String defaultArgName = DEFAULT_ARG_NAME; protected Comparator optionComparator = new OptionComparator(); public void setWidth(int width) {\n        this.defaultWidth = width;\n    }\n\n    \n    public int getWidth() {\n        return defaultWidth;\n    }\n\n    \n    public void setLeftPadding(int padding) {\n        this.defaultLeftPad = padding;\n    }\n\n    \n    public int getLeftPadding() {\n        return defaultLeftPad;\n    }\n\n    \n    public void setDescPadding(int padding) {\n        this.defaultDescPad = padding;\n    }\n\n    \n    public int getDescPadding() {\n        return defaultDescPad;\n    }\n\n    \n    public void setSyntaxPrefix(String prefix) {\n        this.defaultSyntaxPrefix = prefix;\n    }\n\n    \n    public String getSyntaxPrefix() {\n        return defaultSyntaxPrefix;\n    }\n\n    \n    public void setNewLine(String newline) {\n        this.defaultNewLine = newline;\n    }\n\n    \n    public String getNewLine() {\n        return defaultNewLine;\n    }\n\n    \n    public void setOptPrefix(String prefix) {\n        this.defaultOptPrefix = prefix;\n    }\n\n    \n    public String getOptPrefix() {\n        return defaultOptPrefix;\n    }\n\n    \n    public void setLongOptPrefix(String prefix) {\n        this.defaultLongOptPrefix = prefix;\n    }\n\n    \n    public String getLongOptPrefix() {\n        return defaultLongOptPrefix;\n    }\n\n    \n    public void setArgName(String name) {\n        this.defaultArgName = name;\n    }\n\n    \n    public String getArgName() {\n        return defaultArgName;\n    }\n\n    \n    public Comparator getOptionComparator() {\n        return optionComparator;\n    }\n\n    \n    public void setOptionComparator(Comparator comparator) {\n        if (comparator == null)\n        {\n            this.optionComparator = new OptionComparator();\n        }\n        else\n        {\n            this.optionComparator = comparator;\n        }\n    }\n\n    \n    public void printHelp(String cmdLineSyntax, Options options) {\n        printHelp(defaultWidth, cmdLineSyntax, null, options, null, false);\n    }\n\n    \n    public void printHelp(String cmdLineSyntax, Options options, boolean autoUsage) {\n        printHelp(defaultWidth, cmdLineSyntax, null, options, null, autoUsage);\n    }\n\n    \n    public void printHelp(String cmdLineSyntax, String header, Options options, String footer) {\n        printHelp(cmdLineSyntax, header, options, footer, false);\n    }\n\n    \n    public void printHelp(String cmdLineSyntax, String header, Options options, String footer, boolean autoUsage) {\n        printHelp(defaultWidth, cmdLineSyntax, header, options, footer, autoUsage);\n    }\n\n    \n    public void printHelp(int width, String cmdLineSyntax, String header, Options options, String footer) {\n        printHelp(width, cmdLineSyntax, header, options, footer, false);\n    }\n\n    \n    public void printHelp(int width, String cmdLineSyntax, String header, Options options, String footer, boolean autoUsage) {\n        PrintWriter pw = new PrintWriter(System.out);\n\n        printHelp(pw, width, cmdLineSyntax, header, options, defaultLeftPad, defaultDescPad, footer, autoUsage);\n        pw.flush();\n    }\n\n    \n    public void printHelp(PrintWriter pw, int width, String cmdLineSyntax, String header, Options options, int leftPad, int descPad, String footer) {\n        printHelp(pw, width, cmdLineSyntax, header, options, leftPad, descPad, footer, false);\n    }\n\n\n    \n    public void printHelp(PrintWriter pw, int width, String cmdLineSyntax, String header, Options options, int leftPad, int descPad, String footer, boolean autoUsage) {\n        if ((cmdLineSyntax == null) || (cmdLineSyntax.length() == 0))\n        {\n            throw new IllegalArgumentException(\"cmdLineSyntax not provided\");\n        }\n\n        if (autoUsage)\n        {\n            printUsage(pw, width, cmdLineSyntax, options);\n        }\n        else\n        {\n            printUsage(pw, width, cmdLineSyntax);\n        }\n\n        if ((header != null) && (header.trim().length() > 0))\n        {\n            printWrapped(pw, width, header);\n        }\n\n        printOptions(pw, width, options, leftPad, descPad);\n\n        if ((footer != null) && (footer.trim().length() > 0))\n        {\n            printWrapped(pw, width, footer);\n        }\n    }\n\n    \n    public void printUsage(PrintWriter pw, int width, String app, Options options) {\n        \n        StringBuffer buff = new StringBuffer(defaultSyntaxPrefix).append(app).append(\" \");\n\n        \n        final Collection processedGroups = new ArrayList();\n\n        \n        Option option;\n\n        List optList = new ArrayList(options.getOptions());\n        Collections.sort(optList, getOptionComparator());\n        \n        for (Iterator i = optList.iterator(); i.hasNext();)\n        {\n            \n            option = (Option) i.next();\n\n            \n            OptionGroup group = options.getOptionGroup(option);\n\n            \n            if (group != null)\n            {\n                \n                if (!processedGroups.contains(group))\n                {\n                    \n                    processedGroups.add(group);\n\n\n                    \n                    appendOptionGroup(buff, group);\n                }\n\n                \n                \n            }\n\n            \n            else\n            {\n                appendOption(buff, option, option.isRequired());\n            }\n\n            if (i.hasNext())\n            {\n                buff.append(\" \");\n            }\n        }\n\n\n        \n        printWrapped(pw, width, buff.toString().indexOf(' ') + 1, buff.toString());\n    }\n\n    \n    private void appendOptionGroup(final StringBuffer buff, final OptionGroup group) {\n        if (!group.isRequired())\n        {\n            buff.append(\"[\");\n        }\n\n        List optList = new ArrayList(group.getOptions());\n        Collections.sort(optList, getOptionComparator());\n        \n        for (Iterator i = optList.iterator(); i.hasNext();)\n        {\n            \n            appendOption(buff, (Option) i.next(), true);\n\n            if (i.hasNext())\n            {\n                buff.append(\" | \");\n            }\n        }\n\n        if (!group.isRequired())\n        {\n            buff.append(\"]\");\n        }\n    }\n\n    \n    private static void appendOption(final StringBuffer buff, final Option option, final boolean required) {\n        if (!required)\n        {\n            buff.append(\"[\");\n        }\n\n        if (option.getOpt() != null)\n        {\n            buff.append(\"-\").append(option.getOpt());\n        }\n        else\n        {\n            buff.append(\"--\").append(option.getLongOpt());\n        }\n\n        \n        if (option.hasArg() && option.hasArgName())\n        {\n            buff.append(\" <\").append(option.getArgName()).append(\">\");\n        }\n\n        \n        if (!required)\n        {\n            buff.append(\"]\");\n        }\n    }\n\n    \n    public void printUsage(PrintWriter pw, int width, String cmdLineSyntax) {\n        int argPos = cmdLineSyntax.indexOf(' ') + 1;\n\n        printWrapped(pw, width, defaultSyntaxPrefix.length() + argPos, defaultSyntaxPrefix + cmdLineSyntax);\n    }\n\n    \n    public void printOptions(PrintWriter pw, int width, Options options, int leftPad, int descPad) {\n        StringBuffer sb = new StringBuffer();\n\n        renderOptions(sb, width, options, leftPad, descPad);\n        pw.println(sb.toString());\n    }\n\n    \n    public void printWrapped(PrintWriter pw, int width, String text) {\n        printWrapped(pw, width, 0, text);\n    }\n\n    \n    public void printWrapped(PrintWriter pw, int width, int nextLineTabStop, String text) {\n        StringBuffer sb = new StringBuffer(text.length());\n\n        renderWrappedText(sb, width, nextLineTabStop, text);\n        pw.println(sb.toString());\n    }\n\n    \n\n    \n    protected StringBuffer renderOptions(StringBuffer sb, int width, Options options, int leftPad, int descPad) {\n        final String lpad = createPadding(leftPad);\n        final String dpad = createPadding(descPad);\n\n        \n        \n        \n        \n        int max = 0;\n        StringBuffer optBuf;\n        List prefixList = new ArrayList();\n\n        List optList = options.helpOptions();\n\n        Collections.sort(optList, getOptionComparator());\n\n        for (Iterator i = optList.iterator(); i.hasNext();)\n        {\n            Option option = (Option) i.next();\n            optBuf = new StringBuffer(8);\n\n            if (option.getOpt() == null)\n            {\n                optBuf.append(lpad).append(\"   \" + defaultLongOptPrefix).append(option.getLongOpt());\n            }\n            else\n            {\n                optBuf.append(lpad).append(defaultOptPrefix).append(option.getOpt());\n\n                if (option.hasLongOpt())\n                {\n                    optBuf.append(',').append(defaultLongOptPrefix).append(option.getLongOpt());\n                }\n            }\n\n            if (option.hasArg())\n            {\n                if (option.hasArgName())\n                {\n                    optBuf.append(\" <\").append(option.getArgName()).append(\">\");\n                }\n                else\n                {\n                    optBuf.append(' ');\n                }\n            }\n\n            prefixList.add(optBuf);\n            max = (optBuf.length() > max) ? optBuf.length() : max;\n        }\n\n        int x = 0;\n\n        for (Iterator i = optList.iterator(); i.hasNext();)\n        {\n            Option option = (Option) i.next();\n            optBuf = new StringBuffer(prefixList.get(x++).toString());\n\n            if (optBuf.length() < max)\n            {\n                optBuf.append(createPadding(max - optBuf.length()));\n            }\n\n            optBuf.append(dpad);\n\n            int nextLineTabStop = max + descPad;\n\n            if (option.getDescription() != null)\n            {\n                optBuf.append(option.getDescription());\n            }\n\n            renderWrappedText(sb, width, nextLineTabStop, optBuf.toString());\n\n            if (i.hasNext())\n            {\n                sb.append(defaultNewLine);\n            }\n        }\n\n        return sb;\n    }\n\n    \n    protected StringBuffer renderWrappedText(StringBuffer sb, int width, int nextLineTabStop, String text) {\n        int pos = findWrapPos(text, width, 0);\n\n        if (pos == -1)\n        {\n            sb.append(rtrim(text));\n\n            return sb;\n        }\n        sb.append(rtrim(text.substring(0, pos))).append(defaultNewLine);\n\n        if (nextLineTabStop >= width)\n        {\n            \n            nextLineTabStop = 1;\n        }\n\n        \n        \n        final String padding = createPadding(nextLineTabStop);\n\n        while (true)\n        {\n            text = padding + text.substring(pos).trim();\n            pos = findWrapPos(text, width, 0);\n\n            if (pos == -1)\n            {\n                sb.append(text);\n\n                return sb;\n            }\n            \n            if ( (text.length() > width) && (pos == nextLineTabStop - 1) ) \n            {\n                pos = width;\n            }\n\n            sb.append(rtrim(text.substring(0, pos))).append(defaultNewLine);\n        }\n    }\n\n    \n    protected int findWrapPos(String text, int width, int startPos) {\n        int pos = -1;\n\n        \n        if (((pos = text.indexOf('\\n', startPos)) != -1 && pos <= width)\n                || ((pos = text.indexOf('\\t', startPos)) != -1 && pos <= width))\n        {\n            return pos + 1;\n        }\n        else if (startPos + width >= text.length())\n        {\n            return -1;\n        }\n\n\n        \n        pos = startPos + width;\n\n        char c;\n\n        while ((pos >= startPos) && ((c = text.charAt(pos)) != ' ')\n                && (c != '\\n') && (c != '\\r'))\n        {\n            --pos;\n        }\n\n        \n        if (pos > startPos)\n        {\n            return pos;\n        }\n        \n        \n        \n        pos = startPos + width;\n\n        while ((pos <= text.length()) && ((c = text.charAt(pos)) != ' ')\n               && (c != '\\n') && (c != '\\r'))\n        {\n            ++pos;\n        }\n\n        return (pos == text.length()) ? (-1) : pos;\n    }\n\n    \n    protected String createPadding(int len) {\n        StringBuffer sb = new StringBuffer(len);\n\n        for (int i = 0; i < len; ++i)\n        {\n            sb.append(' ');\n        }\n\n        return sb.toString();\n    }\n\n    \n    protected String rtrim(String s) {\n        if ((s == null) || (s.length() == 0))\n        {\n            return s;\n        }\n\n        int pos = s.length();\n\n        while ((pos > 0) && Character.isWhitespace(s.charAt(pos - 1)))\n        {\n            --pos;\n        }\n\n        return s.substring(0, pos);\n    }\n\n    \n    \n    \n    \n    private static class OptionComparator implements Comparator { public int compare(Object o1, Object o2) {\n            Option opt1 = (Option) o1;\n            Option opt2 = (Option) o2;\n\n            return opt1.getKey().compareToIgnoreCase(opt2.getKey());\n        }\n    }\n}\n",
      "buggy_signatures": [
        "public int getWidth()",
        "public void setLeftPadding(int padding)",
        "public int getLeftPadding()",
        "public void setDescPadding(int padding)",
        "public int getDescPadding()",
        "public void setSyntaxPrefix(String prefix)",
        "public String getSyntaxPrefix()",
        "public void setNewLine(String newline)",
        "public String getNewLine()",
        "public void setOptPrefix(String prefix)",
        "public String getOptPrefix()",
        "public void setLongOptPrefix(String prefix)",
        "public String getLongOptPrefix()",
        "public void setArgName(String name)",
        "public String getArgName()",
        "public Comparator getOptionComparator()",
        "public void setOptionComparator(Comparator comparator)",
        "public void printHelp(String cmdLineSyntax, Options options)",
        "public void printHelp(String cmdLineSyntax, Options options, boolean autoUsage)",
        "public void printHelp(String cmdLineSyntax, String header, Options options, String footer)",
        "public void printHelp(String cmdLineSyntax, String header, Options options, String footer, boolean autoUsage)",
        "public void printHelp(int width, String cmdLineSyntax, String header, Options options, String footer)",
        "public void printHelp(int width, String cmdLineSyntax, String header, Options options, String footer, boolean autoUsage)",
        "public void printHelp(PrintWriter pw, int width, String cmdLineSyntax, String header, Options options, int leftPad, int descPad, String footer)",
        "public void printHelp(PrintWriter pw, int width, String cmdLineSyntax, String header, Options options, int leftPad, int descPad, String footer, boolean autoUsage)",
        "public void printUsage(PrintWriter pw, int width, String app, Options options)",
        "private void appendOptionGroup(final StringBuffer buff, final OptionGroup group)",
        "private static void appendOption(final StringBuffer buff, final Option option, final boolean required)",
        "public void printUsage(PrintWriter pw, int width, String cmdLineSyntax)",
        "public void printOptions(PrintWriter pw, int width, Options options, int leftPad, int descPad)",
        "public void printWrapped(PrintWriter pw, int width, String text)",
        "public void printWrapped(PrintWriter pw, int width, int nextLineTabStop, String text)",
        "protected StringBuffer renderOptions(StringBuffer sb, int width, Options options, int leftPad, int descPad)",
        "protected StringBuffer renderWrappedText(StringBuffer sb, int width, int nextLineTabStop, String text)",
        "protected int findWrapPos(String text, int width, int startPos)",
        "protected String createPadding(int len)",
        "protected String rtrim(String s)",
        "private static class OptionComparator implements Comparator { public int compare(Object o1, Object o2)"
      ],
      "fixed_signatures": [
        "public int getWidth()",
        "public void setLeftPadding(int padding)",
        "public int getLeftPadding()",
        "public void setDescPadding(int padding)",
        "public int getDescPadding()",
        "public void setSyntaxPrefix(String prefix)",
        "public String getSyntaxPrefix()",
        "public void setNewLine(String newline)",
        "public String getNewLine()",
        "public void setOptPrefix(String prefix)",
        "public String getOptPrefix()",
        "public void setLongOptPrefix(String prefix)",
        "public String getLongOptPrefix()",
        "public void setArgName(String name)",
        "public String getArgName()",
        "public Comparator getOptionComparator()",
        "public void setOptionComparator(Comparator comparator)",
        "public void printHelp(String cmdLineSyntax, Options options)",
        "public void printHelp(String cmdLineSyntax, Options options, boolean autoUsage)",
        "public void printHelp(String cmdLineSyntax, String header, Options options, String footer)",
        "public void printHelp(String cmdLineSyntax, String header, Options options, String footer, boolean autoUsage)",
        "public void printHelp(int width, String cmdLineSyntax, String header, Options options, String footer)",
        "public void printHelp(int width, String cmdLineSyntax, String header, Options options, String footer, boolean autoUsage)",
        "public void printHelp(PrintWriter pw, int width, String cmdLineSyntax, String header, Options options, int leftPad, int descPad, String footer)",
        "public void printHelp(PrintWriter pw, int width, String cmdLineSyntax, String header, Options options, int leftPad, int descPad, String footer, boolean autoUsage)",
        "public void printUsage(PrintWriter pw, int width, String app, Options options)",
        "private void appendOptionGroup(final StringBuffer buff, final OptionGroup group)",
        "private static void appendOption(final StringBuffer buff, final Option option, final boolean required)",
        "public void printUsage(PrintWriter pw, int width, String cmdLineSyntax)",
        "public void printOptions(PrintWriter pw, int width, Options options, int leftPad, int descPad)",
        "public void printWrapped(PrintWriter pw, int width, String text)",
        "public void printWrapped(PrintWriter pw, int width, int nextLineTabStop, String text)",
        "protected StringBuffer renderOptions(StringBuffer sb, int width, Options options, int leftPad, int descPad)",
        "protected StringBuffer renderWrappedText(StringBuffer sb, int width, int nextLineTabStop, String text)",
        "protected int findWrapPos(String text, int width, int startPos)",
        "protected String createPadding(int len)",
        "protected String rtrim(String s)",
        "private static class OptionComparator implements Comparator { public int compare(Object o1, Object o2)"
      ],
      "methods": [
        {
          "buggy_method": "  protected StringBuffer renderWrappedText(StringBuffer sb, int width, int nextLineTabStop, String text) {\n  int pos = findWrapPos(text, width, 0);\n\n  if (pos == -1)\n  {\n  sb.append(rtrim(text));\n\n  return sb;\n  }\n  sb.append(rtrim(text.substring(0, pos))).append(defaultNewLine);\n\n  if (nextLineTabStop >= width)\n  {\n  \n  nextLineTabStop = width - 1;\n  }\n\n  \n  \n  final String padding = createPadding(nextLineTabStop);\n\n  while (true)\n  {\n  text = padding + text.substring(pos).trim();\n  pos = findWrapPos(text, width, 0);\n\n  if (pos == -1)\n  {\n  sb.append(text);\n\n  return sb;\n  }\n  \n  if ( (text.length() > width) && (pos == nextLineTabStop - 1) ) \n  {\n  pos = width;\n  }\n\n  sb.append(rtrim(text.substring(0, pos))).append(defaultNewLine);\n  }\n  }",
          "fixed_method": "  protected StringBuffer renderWrappedText(StringBuffer sb, int width, int nextLineTabStop, String text) {\n  int pos = findWrapPos(text, width, 0);\n\n  if (pos == -1)\n  {\n  sb.append(rtrim(text));\n\n  return sb;\n  }\n  sb.append(rtrim(text.substring(0, pos))).append(defaultNewLine);\n\n  if (nextLineTabStop >= width)\n  {\n  \n  nextLineTabStop = 1;\n  }\n\n  \n  \n  final String padding = createPadding(nextLineTabStop);\n\n  while (true)\n  {\n  text = padding + text.substring(pos).trim();\n  pos = findWrapPos(text, width, 0);\n\n  if (pos == -1)\n  {\n  sb.append(text);\n\n  return sb;\n  }\n  \n  if ( (text.length() > width) && (pos == nextLineTabStop - 1) ) \n  {\n  pos = width;\n  }\n\n  sb.append(rtrim(text.substring(0, pos))).append(defaultNewLine);\n  }\n  }",
          "diff": [
            "@@ -822,7 +822,7 @@",
            "         if (nextLineTabStop >= width)\n",
            "         {\n",
            "             // stops infinite loop happening\n",
            "-            nextLineTabStop = width - 1;\n",
            "+            nextLineTabStop = 1;\n",
            "         }\n",
            " \n",
            "         // all following lines must be padded with nextLineTabStop space \n"
          ],
          "changed_lines": 2
        }
      ]
    }
  ]
}
